# コミットメッセージ生成

ステージング済みの変更を分析し、Conventional Commits形式のコミットメッセージを生成します。

---
allowed-tools: Bash(git status:*), Bash(git diff:*), Bash(git commit:*)
description: staged changesを分析してコミットメッセージを生成し、承認後にコミット
---

## プロジェクトルールの参照

コミットメッセージを生成する前に、以下を確認してください：

1. commitlint 設定ファイルがあれば参照する（必須ルール、優先度順）：
   - `commitlint.config.js` / `commitlint.config.cjs` / `commitlint.config.mjs`
   - `.commitlintrc.js` / `.commitlintrc.json` / `.commitlintrc.yml`
   - `package.json` の `commitlint` フィールド
2. プロジェクトの `CLAUDE.md` にコミットメッセージ規約があるか確認（補足ガイドライン）
3. プロジェクト固有のルールがこのコマンドのデフォルトルールと異なる場合は、プロジェクトのルールを優先する

## 実行手順

### 1. ステージング状態の確認

まずステージング済みの変更があるか確認します：

```bash
git status
```

**ステージング済みの変更がない場合は、処理を中断してユーザーに `git add` を促してください。**

### 2. 変更内容の分析

ステージング済みの差分を取得します：

```bash
git diff --cached
```

### 3. コミットメッセージの生成

差分を分析し、以下のルールに従ってコミットメッセージを生成してください。

#### フォーマット

```
<type>(<scope>): <subject>
```

#### type（変更の種類）

| type | 用途 |
|------|------|
| `feat` | 新機能の追加 |
| `fix` | バグ修正 |
| `docs` | ドキュメントの変更 |
| `style` | コードフォーマット、セミコロン等（動作に影響しない変更） |
| `refactor` | リファクタリング（機能追加・バグ修正を含まない） |
| `perf` | パフォーマンス改善 |
| `test` | テストの追加・修正 |
| `chore` | ビルドプロセス、補助ツールの変更 |
| `ci` | CI設定の変更 |

#### scope（影響範囲）

- 原則必須
- 変更対象のモジュール名、機能名、ファイル名などを記載
- 複数ファイルにまたがる場合は、最も代表的な範囲を選択
- 例: `auth`, `api`, `ui`, `config`, `db`

#### subject（変更内容の要約）

- 日本語で記述
- 50文字以内を目安
- 体言止めまたは動詞で終わる簡潔な表現
- 例: 「ログイン機能を追加」「バリデーションエラーを修正」

### 4. ユーザーへの提案

生成したコミットメッセージを以下の形式で提案してください：

```
## 提案するコミットメッセージ

<生成したコミットメッセージ>

このメッセージでコミットしてよろしいですか？
- 「はい」または「y」で実行
- 修正したい場合は修正内容をお伝えください
```

### 5. コミットの実行

ユーザーの承認を得た後にのみ、コミットを実行します：

```bash
git commit -m "<承認されたコミットメッセージ>"
```

## 注意事項

- ステージングされていない変更は対象外です
- ユーザーの明示的な承認なしにコミットを実行しないでください
- メッセージの修正依頼があった場合は、修正版を再提案してください
